class ToolTracker{constructor(options={}){this.config={storageKey:'tool_history',maxRecords:10,cookieConsentKey:'tool_tracker_consent',debugMode:false,...options};this.languageConfig={'en-US':{cookieTitle:'Cookie Consent',cookieMessage:'We use cookies to enhance your experience. These cookies store your tool usage history locally in your browser to help you find recently used tools. We do not collect or analyze this data. <a href="'+citydomain+'article/cookie-privacy/" target="_blank">Learn more</a>.',acceptButton:'Accept',declineButton:'Decline',noData:'No data yet',viewFavorites:'View My Favorites',clearAll:'Clear All'},'en-AU':{cookieTitle:'Cookie Consent',cookieMessage:'We use cookies to enhance your experience. These cookies store your tool usage history locally in your browser to help you find recently used tools. We do not collect or analyze this data. <a href="'+citydomain+'article/cookie-privacy/" target="_blank">Learn more</a>.',acceptButton:'Accept',declineButton:'Decline',noData:'No data yet',viewFavorites:'View My Favorites',clearAll:'Clear All'},'en-GB':{cookieTitle:'Cookie Consent',cookieMessage:'We use cookies to enhance your experience. These cookies store your tool usage history locally in your browser to help you find recently used tools. We do not collect or analyze this data. <a href="'+citydomain+'article/cookie-privacy/" target="_blank">Learn more</a>.',acceptButton:'Accept',declineButton:'Decline',noData:'No data yet',viewFavorites:'View My Favorites',clearAll:'Clear All'},'fr':{cookieTitle:'Consentement aux cookies',cookieMessage:'Nous utilisons des cookies pour améliorer votre expérience. Ces cookies stockent localement dans votre navigateur l\'historique de vos outils utilisés afin de vous aider à trouver les outils récemment utilisés. Nous ne collectons ni n\'analysons ces données. <a href="'+citydomain+'article/cookie-privacy/" target="_blank">En savoir plus</a>.',acceptButton:'Accepter',declineButton:'Refuser',noData:'Aucune donnée pour le moment',viewFavorites:'Voir mes favoris',clearAll:'Tout effacer'},'es':{cookieTitle:'Consentimiento de Cookies',cookieMessage:'Utilizamos cookies para mejorar su experiencia. Estas cookies almacenan localmente en su navegador el historial de uso de herramientas para ayudarle a encontrar herramientas utilizadas recientemente. No recopilamos ni analizamos estos datos. <a href="'+citydomain+'article/cookie-privacy/" target="_blank">Más información</a>.',acceptButton:'Aceptar',declineButton:'Rechazar',noData:'Aún no hay datos',viewFavorites:'Ver mis favoritos',clearAll:'Borrar todo'},'it':{cookieTitle:'Consenso sui Cookie',cookieMessage:'Utilizziamo cookie per migliorare la tua esperienza. Questi cookie memorizzano localmente nel tuo browser la cronologia dell\'uso degli strumenti per aiutarti a trovare gli strumenti utilizzati di recente. Non raccogliamo né analizziamo questi dati. <a href="'+citydomain+'article/cookie-privacy/" target="_blank">Scopri di più</a>.',acceptButton:'Accetta',declineButton:'Rifiuta',noData:'Ancora nessun dato',viewFavorites:'Visualizza i miei preferiti',clearAll:'Cancella tutto'},'ja':{cookieTitle:'クッキーの使用について',cookieMessage:'当サイトでは、ユーザー体験向上のためクッキーを使用しています。これらのクッキーは、最近使用したツールの記録をブラウザにローカル保存します（当社がこのデータを収集・分析することはありません）。<a href="'+citydomain+'article/cookie-privacy/" target="_blank">詳細はこちら</a>',acceptButton:'同意する',declineButton:'拒否する',noData:'データがありません',viewFavorites:'お気に入りを表示',clearAll:'すべてクリア'},'zh-CN':{cookieTitle:'Cookie 信息',cookieMessage:'我们使用 Cookie 技术在您的浏览器中本地存储工具使用记录，以便您查找最近使用的工具。这些数据不会被收集或用于其他分析，请放心使用。<a href="'+citydomain+'article/cookie-privacy/" target="_blank">了解更多</a>。',acceptButton:'接受',declineButton:'拒绝',noData:'暂无数据',viewFavorites:'查看我的收藏',clearAll:'清除全部'},'zh-TW':{cookieTitle:'Cookie 資訊',cookieMessage:'我們使用 Cookie 技術在您的瀏覽器中本地存儲工具使用記錄，以便您查找最近使用的工具。這些數據不會被收集或用於其他分析，請放心使用。<a href="'+citydomain+'article/cookie-privacy/" target="_blank">了解更多</a>。',acceptButton:'接受',declineButton:'拒絕',noData:'暫無數據',viewFavorites:'查看我的收藏',clearAll:'清除全部'}};this.userLanguage=this.getUserLanguage();this.currentLangConfig=this.languageConfig[this.userLanguage]||this.languageConfig['en-US'];this.init()}init(){if(this.config.debugMode){console.log('[ToolTracker] Debug mode is enabled');window.clearToolTrackerDebug=()=>{localStorage.removeItem(this.config.storageKey);localStorage.removeItem(this.config.cookieConsentKey);console.log('[ToolTracker] Debug: Cleared all storage data')}}if(this.shouldShowCookieConsent()){this.showCookieConsent();return}else{this.setConsent(true)}if(this.isToolPage()){this.recordVisit()}else if(document.getElementById('showHistory')){this.renderHistory()}}shouldShowCookieConsent(){if(this.config.debugMode){return true}if(this.hasConsent()!==null){return false}const langPart=this.userLanguage.split('-')[0];const showConsentLanguages=['de','fr','it','es'];return showConsentLanguages.includes(langPart)}getUserLanguage(){const userLang=navigator.language||navigator.userLanguage;if(this.languageConfig[userLang]){return userLang}const langPart=userLang.split('-')[0];for(const key in this.languageConfig){if(key.startsWith(langPart+'-')){return key}}return'en-US'}hasConsent(){const consent=localStorage.getItem(this.config.cookieConsentKey);return consent===null?null:consent==='true'}setConsent(consent){localStorage.setItem(this.config.cookieConsentKey,consent?'true':'false');if(consent){if(this.isToolPage()){this.recordVisit()}else if(document.getElementById('showHistory')){this.renderHistory()}}else{this.renderDeclineState()}}showCookieConsent(){const container=document.getElementById('showHistory');if(!container)return;const cookieBox=document.createElement('div');cookieBox.className='cookie-consent-box';cookieBox.innerHTML=`<h3>${this.currentLangConfig.cookieTitle}</h3><p>${this.currentLangConfig.cookieMessage}</p><div class="cookie-buttons"><button class="accept-cookie">${this.currentLangConfig.acceptButton}</button><button class="decline-cookie">${this.currentLangConfig.declineButton}</button></div>`;container.innerHTML='';container.appendChild(cookieBox);container.addEventListener('click',(e)=>{if(e.target.classList.contains('accept-cookie')){this.setConsent(true)}else if(e.target.classList.contains('decline-cookie')){this.setConsent(false)}})}renderDeclineState(){const container=document.getElementById('showHistory');if(!container)return;container.innerHTML=`<a href="/dashboard/?m=favorites&lang=${lang}"class="view-favorites-btn"rel="nofollow noreferer">${this.currentLangConfig.viewFavorites}</a>`}isToolPage(){return typeof tool_id!=='undefined'&&typeof tool_name!=='undefined'&&typeof tool_url!=='undefined'&&typeof tool_image!=='undefined'}getStorage(){try{return JSON.parse(localStorage.getItem(this.config.storageKey))||[]}catch(e){return[]}}setStorage(data){try{localStorage.setItem(this.config.storageKey,JSON.stringify(data))}catch(e){console.error('Local storage failed:',e)}}recordVisit(){if(this.hasConsent()===false){return}const history=this.getStorage().filter(item=>item.id!==tool_id).slice(0,this.config.maxRecords-1);history.unshift({id:tool_id,name:tool_name,url:tool_url,image:tool_image,domain:location.hostname,time:Date.now()});this.setStorage(history)}renderHistory(){const container=document.getElementById('showHistory');if(!container)return;this.clearOldElements(container);const history=this.getStorage();if(history.length===0){this.showNoData(container);return}const toolsContainer=document.createElement('div');toolsContainer.className='tools-container';container.appendChild(toolsContainer);history.forEach(tool=>{toolsContainer.appendChild(this.createToolElement(tool))});this.addClearButton(container)}createToolElement(tool){const el=document.createElement('a');el.href=tool.url;el.className='related-tool-card history-item';el.innerHTML=`<div class="related-tool-icon"><img width="30"height="30"src="${wwwdomain}${wwwlogo}"data-src="${tool.image}"alt="${tool.name}"loading="lazy"></div><div class="tooltool-name">${tool.name}</div><button class="delete-tool-btn"data-id="${tool.id}"><svg viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg></button>`;const img=el.querySelector('img[data-src]');if(img){const io=new IntersectionObserver((entries,observer)=>{entries.forEach(entry=>{if(entry.isIntersecting){const img=entry.target;img.src=img.dataset.src;observer.unobserve(img)}})});io.observe(img)}return el}clearOldElements(container){container.querySelectorAll('.history-item, .no-history-message, .clear-history-btn, .tools-container, .cookie-consent-box, .view-favorites-btn').forEach(el=>el.remove())}showNoData(container){const msg=document.createElement('div');msg.className='no-history-message';msg.textContent=this.currentLangConfig.noData;container.appendChild(msg)}addClearButton(container){}deleteRecord(id){this.setStorage(this.getStorage().filter(item=>item.id!==id));this.renderHistory()}clearAll(){this.setStorage([]);this.renderHistory()}}document.addEventListener('DOMContentLoaded',()=>{const urlParams=new URLSearchParams(window.location.search);const debugMode=urlParams.get('debug')==='0';const tracker=new ToolTracker({debugMode});document.addEventListener('click',e=>{if(e.target.closest('.delete-tool-btn')){e.preventDefault();tracker.deleteRecord(e.target.closest('.delete-tool-btn').dataset.id)}})});