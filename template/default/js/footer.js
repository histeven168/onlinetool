/**********************************----------------ios export-------------------****************************/
const isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)||navigator.vendor==="Apple Computer, Inc.";function shouldShowPrompt(){const closedTime=localStorage.getItem('promptClosedTime');if(!closedTime)return true;const now=new Date().getTime();const twentyFourHours=24*60*60*1000;return(now-parseInt(closedTime))>twentyFourHours}function initPrompt(){const prompt=document.querySelector('.save-prompt');if(!prompt)return;if(isSafari&&shouldShowPrompt()){prompt.style.display='block'}else{prompt.style.display='none'}}function closePrompt(){const prompt=document.querySelector('.save-prompt');if(prompt){prompt.style.display='none';localStorage.setItem('promptClosedTime',new Date().getTime())}}function openPrompt(){const prompt=document.querySelector('.save-prompt');if(prompt){prompt.style.display='block';localStorage.removeItem('promptClosedTime')}}document.addEventListener('DOMContentLoaded',initPrompt);
/***************************-----------------backtotop-----------------***************************/
document.addEventListener('DOMContentLoaded',function(){const backToTopBtn=document.getElementById('back-to-top');window.addEventListener('scroll',function(){backToTopBtn.classList.toggle('show',window.scrollY>100)});backToTopBtn.addEventListener('click',function(e){e.preventDefault();window.scrollTo({top:0,behavior:'smooth'})})});
/*********------------------------login dialog----------------------**********/
function setupLoginDialog(){const loginDialog=document.getElementById('loginDialog');const closeDialog=document.getElementById('closeDialog');function showLoginDialog(){loginDialog.classList.add('active')}function hideLoginDialog(){loginDialog.classList.remove('active')}function initDialog(){closeDialog.addEventListener('click',hideLoginDialog);loginDialog.addEventListener('click',function(e){if(e.target===loginDialog){hideLoginDialog()}});document.addEventListener('keydown',function(e){if(e.key==='Escape'){hideLoginDialog()}})}initDialog();return{show:showLoginDialog,hide:hideLoginDialog}}
/*********------------------------image lazy load----------------------**********/
document.addEventListener("DOMContentLoaded",function(){const lazyImages=document.querySelectorAll("img[data-src]");const lazyLoad=(target)=>{const io=new IntersectionObserver((entries,observer)=>{entries.forEach((entry)=>{if(entry.isIntersecting){const img=entry.target;img.src=img.dataset.src;observer.unobserve(img)}})});io.observe(target)};lazyImages.forEach(lazyLoad)});if(iflogin!=1){document.addEventListener("DOMContentLoaded",function(){const loginDialog=setupLoginDialog();const loginBtn=document.querySelector(".login-btn");const commentForms=document.querySelector(".comments__form");const loginDropdown=document.querySelector(".dropdown-dashboard");const commentMessage=document.getElementById("comment-message");const isPC=window.innerWidth>768;if(loginBtn){loginBtn.addEventListener("click",loginDialog.show)}if(commentForms){document.querySelector(".comments__form_submit").disabled=true;commentForms.addEventListener("click",loginDialog.show)}if(loginDropdown){loginDropdown.style.display="none"}if(commentMessage){commentMessage.addEventListener("click",loginDialog.show)}if(fromCountry!="CN"&&isPC){const container=document.getElementById("gglg");if(container){const script=document.createElement("script");script.src="https://accounts.google.com/gsi/client";script.async=true;script.defer=true;const div=document.createElement("div");div.id="g_id_onload";div.setAttribute("data-client_id","697208109938-7l9ujqi2u0rqiij120kah7tg6vq75gml.apps.googleusercontent.com");div.setAttribute("data-login_uri",`${wwwdomain}/include/googlelogin/googlelogin.php`);div.setAttribute("data-auto_prompt","true");container.appendChild(script);container.appendChild(div)}}})}else{document.addEventListener("DOMContentLoaded",function(){const loginBtn=document.getElementById("login-btn");const loginBtnMobile=document.getElementById("login-btn-mobile");function handleButtonClick(){window.location.href=citydomain+"dashboard/"}if(loginBtn){loginBtn.addEventListener("click",handleButtonClick);loginBtn.textContent=_LANG.dashboard}if(loginBtnMobile){loginBtnMobile.addEventListener("click",handleButtonClick);loginBtnMobile.textContent=_LANG.dashboard}})}
/***********--------------------------footer qrcode mobile toogle----------------*********/
document.addEventListener('DOMContentLoaded',function(){const qrContainer=document.getElementById('footer-qrcode');if(qrContainer){const observer=new IntersectionObserver(function(entries){entries.forEach(function(entry){if(entry.isIntersecting){const script=document.createElement('script');script.src=wwwdomain+'/template/default/js/qrcode.min.js';script.onload=function(){new QRCode(qrContainer,{text:window.location.href,width:120,height:120,colorDark:'#000000',colorLight:'#ffffff',correctLevel:QRCode.CorrectLevel.H})};document.head.appendChild(script);observer.unobserve(qrContainer)}})},{rootMargin:'30px'});observer.observe(qrContainer)}const footerToggles=document.querySelectorAll('.footer-toggle');footerToggles.forEach(toggle=>{toggle.addEventListener('click',function(){if(window.innerWidth<=768){const targetId=this.getAttribute('data-target');const targetElement=document.getElementById(targetId);if(targetElement){this.classList.toggle('active');targetElement.classList.toggle('active')}}})});window.addEventListener('resize',function(){if(window.innerWidth>768){document.querySelectorAll('.footer-toggle').forEach(toggle=>{toggle.classList.remove('active')});document.querySelectorAll('.footer-links, .footer-tools-grid, .mobile-qr').forEach(content=>{content.classList.remove('active')})}})});
/*****************************************-----search-----*******************************/
const SEARCH_CONFIG={minDropdownWidth:300,dataBasePath:wwwdomain+'/data/search/'};document.addEventListener('DOMContentLoaded',function(){let searchData=[];function loadSearchData(){const langFile=`${lang}.json`;const dataUrl=`${SEARCH_CONFIG.dataBasePath}${langFile}`;fetch(dataUrl).then(response=>{if(!response.ok)throw new Error('Network response was not ok');return response.json()}).then(data=>{searchData=data;initSearch()}).catch(error=>{console.error('Error loading search data:',error);if(lang!=='en-US'){console.log('Trying to load English fallback data...');lang='en-US';loadSearchData()}})}loadSearchData();function initSearch(){const searchInputs=document.querySelectorAll('.search_input');searchInputs.forEach(searchInput=>{const container=searchInput.parentNode;if(getComputedStyle(container).position!=='relative'){container.style.position='relative'}const resultsContainer=document.createElement('div');resultsContainer.className='activeSearch-results';container.appendChild(resultsContainer);updateDropdownPosition(searchInput,resultsContainer);const resizeObserver=new ResizeObserver(()=>{updateDropdownPosition(searchInput,resultsContainer)});resizeObserver.observe(searchInput);const handleInput=function(){const query=this.value.trim();const cleanQuery=query.replace(/[：:]/g,'');if(cleanQuery.length===0){showLatestResults(resultsContainer);return}const results=searchData.filter(item=>{const name=item.name||'';const category=item.category||'';return name.toLowerCase().includes(cleanQuery.toLowerCase())||category.toLowerCase().includes(cleanQuery.toLowerCase())});displayResults(results,resultsContainer)};const handleClick=function(){if(this.value.trim().length===0){showLatestResults(resultsContainer)}};searchInput.addEventListener('input',handleInput);searchInput.addEventListener('focus',handleInput);searchInput.addEventListener('click',handleClick);document.addEventListener('click',function(e){if(!container.contains(e.target)){resultsContainer.style.display='none'}});resultsContainer.addEventListener('click',function(e){const link=e.target.closest('.activeSearch-link');if(link){e.preventDefault();window.location.href=link.href}})})}function showLatestResults(container){if(searchData.length===0)return;const latestResults=searchData.slice(0,7);displayResults(latestResults,container)}function updateDropdownPosition(input,dropdown){const inputWidth=input.offsetWidth;dropdown.style.width=`${Math.max(inputWidth,SEARCH_CONFIG.minDropdownWidth)}px`;dropdown.style.left='0';dropdown.style.top=`${input.offsetHeight+5}px`}function displayResults(results,container){container.innerHTML='';if(results.length===0){const noResults=document.createElement('div');noResults.className='activeSearch-no-results';noResults.textContent=getNoResultsText(lang);container.appendChild(noResults);container.style.display='block';return}const list=document.createElement('ul');list.className='activeSearch-list';const titleItem=document.createElement('li');titleItem.className='activeSearch-title';list.appendChild(titleItem);results.forEach(item=>{const li=document.createElement('li');li.className='activeSearch-item';const link=document.createElement('a');link.href=item.url;link.className='activeSearch-link';const nameSpan=document.createElement('span');nameSpan.className='activeSearch-name';nameSpan.textContent=item.name||'';const categorySpan=document.createElement('span');categorySpan.className='activeSearch-category';categorySpan.textContent=item.category||'';link.appendChild(nameSpan);link.appendChild(categorySpan);li.appendChild(link);list.appendChild(li)});container.appendChild(list);container.style.display='block'}function getNoResultsText(languagec){const texts={"en-US":"No results found","de":"Keine Ergebnisse gefunden","fr":"Aucun résultat trouvé","es":"No se encontraron resultados","it":"Nessun risultato trovato","ja":"表示するデータがありません","zh":"暂无结果"};return texts[languagec]||texts.en}window.setSearchLanguage=function(languagec){if(languagec!==lang){languagec=lang;loadSearchData()}}});