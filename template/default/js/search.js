document.addEventListener('DOMContentLoaded',function(){let searchData=[];function loadSearchData(){const langFile=`${SEARCH_CONFIG.language}.json`;const dataUrl=`${SEARCH_CONFIG.dataBasePath}${langFile}`;fetch(dataUrl).then(response=>{if(!response.ok)throw new Error('Network response was not ok');return response.json()}).then(data=>{searchData=data;initSearch()}).catch(error=>{console.error('Error loading search data:',error);if(SEARCH_CONFIG.language!=='en-US'){console.log('Trying to load English fallback data...');SEARCH_CONFIG.language='en-US';loadSearchData()}})}loadSearchData();function initSearch(){const searchInputs=document.querySelectorAll('.search_input');searchInputs.forEach(searchInput=>{const container=searchInput.parentNode;if(getComputedStyle(container).position!=='relative'){container.style.position='relative'}const resultsContainer=document.createElement('div');resultsContainer.className='activeSearch-results';container.appendChild(resultsContainer);updateDropdownPosition(searchInput,resultsContainer);const resizeObserver=new ResizeObserver(()=>{updateDropdownPosition(searchInput,resultsContainer)});resizeObserver.observe(searchInput);const handleInput=function(){const query=this.value.trim();const cleanQuery=query.replace(/[：:]/g,'');if(cleanQuery.length===0){showLatestResults(resultsContainer);return}const results=searchData.filter(item=>{const name=item.name||'';const category=item.category||'';return name.toLowerCase().includes(cleanQuery.toLowerCase())||category.toLowerCase().includes(cleanQuery.toLowerCase())});displayResults(results,resultsContainer)};const handleClick=function(){if(this.value.trim().length===0){showLatestResults(resultsContainer)}};searchInput.addEventListener('input',handleInput);searchInput.addEventListener('focus',handleInput);searchInput.addEventListener('click',handleClick);document.addEventListener('click',function(e){if(!container.contains(e.target)){resultsContainer.style.display='none'}});resultsContainer.addEventListener('click',function(e){const link=e.target.closest('.activeSearch-link');if(link){e.preventDefault();window.location.href=link.href}})})}function showLatestResults(container){if(searchData.length===0)return;const latestResults=searchData.slice(0,5);displayResults(latestResults,container)}function updateDropdownPosition(input,dropdown){const inputWidth=input.offsetWidth;dropdown.style.width=`${Math.max(inputWidth,SEARCH_CONFIG.minDropdownWidth)}px`;dropdown.style.left='0';dropdown.style.top=`${input.offsetHeight+5}px`}function displayResults(results,container){container.innerHTML='';if(results.length===0){const noResults=document.createElement('div');noResults.className='activeSearch-no-results';noResults.textContent=getNoResultsText(SEARCH_CONFIG.language);container.appendChild(noResults);container.style.display='block';return}const list=document.createElement('ul');list.className='activeSearch-list';const titleItem=document.createElement('li');titleItem.className='activeSearch-title';list.appendChild(titleItem);results.forEach(item=>{const li=document.createElement('li');li.className='activeSearch-item';const link=document.createElement('a');link.href=item.url;link.className='activeSearch-link';const nameSpan=document.createElement('span');nameSpan.className='activeSearch-name';nameSpan.textContent=item.name||'';const categorySpan=document.createElement('span');categorySpan.className='activeSearch-category';categorySpan.textContent=item.category||'';link.appendChild(nameSpan);link.appendChild(categorySpan);li.appendChild(link);list.appendChild(li)});container.appendChild(list);container.style.display='block'}function getNoResultsText(lang){const texts={"en-US":"No results found","de":"Keine Ergebnisse gefunden","fr":"Aucun résultat trouvé","es":"No se encontraron resultados","it":"Nessun risultato trovato","zh":"暂无结果"};return texts[lang]||texts.en}window.setSearchLanguage=function(lang){if(SEARCH_CONFIG.language!==lang){SEARCH_CONFIG.language=lang;loadSearchData()}}});